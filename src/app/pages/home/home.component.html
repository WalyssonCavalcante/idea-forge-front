<app-floating-lines
  class="page-background"
  [enabledWaves]="enabledWaves"
  [lineCount]="5"
  [lineDistance]="5"
  [bendRadius]="5"
  [bendStrength]="-0.5"
  [interactive]="true"
  [parallax]="false"
/>

<app-header />

<main class="page-content">
  <section class="hero">
    <h1 class="hero__title">
      Pare de pensar.
      <span class="hero__title-highlight">Comece a codar.</span>
    </h1>

    <p class="hero__subtitle">
      Receba ideias de projetos sob medida baseadas na sua stack e no seu nível de
      experiência.
    </p>

    <article class="generator-card">
      <label class="field-label" for="current-stacks">Stacks Atuais</label>
      <div class="tag-input">
        @for (stack of stacks; track stack) {
          <span class="tag-chip">
            {{ stack }}
            <button
              type="button"
              class="tag-chip__remove"
              (click)="removeTag('stacks', stack)"
              [attr.aria-label]="'Remover ' + stack"
            >
              ×
            </button>
          </span>
        }
        <input
          id="current-stacks"
          class="tag-input__field"
          type="text"
          [attr.placeholder]="stacks.length === 0 ? 'Ex: React, Python, Node.js...' : null"
          (focus)="onTagFocus('stacks')"
          (keydown)="onTagKeydown($event, 'stacks')"
          (blur)="onTagBlur($event, 'stacks')"
        />
      </div>
      <p class="field-hint">Pressione Enter ou vírgula para adicionar</p>

      <h2 class="field-label">Nível de Experiência</h2>
      <div class="experience-group" role="group" aria-label="Nível de experiência">
        <button
          type="button"
          class="experience-button"
          [class.experience-button--active]="experienceLevel === 'iniciante'"
          (click)="setExperience('iniciante')"
        >
          Iniciante
        </button>

        <button
          type="button"
          class="experience-button"
          [class.experience-button--active]="experienceLevel === 'intermediario'"
          (click)="setExperience('intermediario')"
        >
          Intermediário
        </button>

        <button
          type="button"
          class="experience-button"
          [class.experience-button--active]="experienceLevel === 'avancado'"
          (click)="setExperience('avancado')"
        >
          Avançado
        </button>
      </div>

      <label class="field-label" for="focus-areas">Áreas de Foco (opcional)</label>
      <div class="tag-input">
        @for (focusArea of focusAreas; track focusArea) {
          <span class="tag-chip">
            {{ focusArea }}
            <button
              type="button"
              class="tag-chip__remove"
              (click)="removeTag('focusAreas', focusArea)"
              [attr.aria-label]="'Remover ' + focusArea"
            >
              ×
            </button>
          </span>
        }
        <input
          id="focus-areas"
          class="tag-input__field"
          type="text"
          [attr.placeholder]="focusAreas.length === 0 ? 'Ex: Arquitetura, Testes, DevOps...' : null"
          (keydown)="onTagKeydown($event, 'focusAreas')"
          (blur)="onTagBlur($event, 'focusAreas')"
        />
      </div>
      <p class="field-hint">Pressione Enter ou vírgula para adicionar</p>

      <button
        type="button"
        class="generate-button"
        [disabled]="isGenerating || stacks.length === 0"
        (click)="generateProject()"
      >
        <svg
          class="generate-button__icon"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <path d="M4 20L11 13" />
          <path d="M15 6l3-3 3 3-3 3-3-3Z" />
          <path d="M7 17l-4 4" />
          <path d="M14 7l3 3" />
          <path d="M5 7h4" />
          <path d="M7 5v4" />
        </svg>
        {{ isGenerating ? 'Gerando...' : 'Gerar Projeto' }}
      </button>

      @if (showStacksRequiredMessage) {
        <p class="response-message" role="status">Adicione pelo menos uma stack para gerar uma ideia.</p>
      }

      @if (requestError) {
        <p class="response-message response-message--error" role="alert">{{ requestError }}</p>
      }
    </article>

    @if (generatedIdeas.length > 0) {
      <section class="ideas-grid" aria-live="polite">
        @for (idea of generatedIdeas; track $index; let index = $index) {
          <button
            type="button"
            class="idea-card"
            [class.idea-card--selected]="expandedIdeaIndex === index"
            (click)="openExpandedIdea(index)"
          >
            <span class="idea-card__badge">Projeto {{ index + 1 }}</span>
            <h3 class="idea-card__title">{{ idea.title }}</h3>
            <p class="idea-card__preview">{{ idea.preview }}</p>
            <span class="idea-card__cta">Clique para expandir</span>
          </button>
        }
      </section>
    }

    @if ((generatedText || generatedJson) && generatedIdeas.length === 0) {
      <section class="response-card" aria-live="polite">
        @if (generatedText) {
          <p class="response-card__summary">{{ generatedText }}</p>
        }
        @if (generatedJson) {
          <pre class="response-card__json">{{ generatedJson }}</pre>
        }
      </section>
    }
  </section>
</main>

@if (expandedIdea; as idea) {
  <div class="idea-overlay" (click)="closeExpandedIdea()">
    <article
      class="idea-modal"
      role="dialog"
      aria-modal="true"
      [attr.aria-label]="'Detalhes do projeto ' + idea.title"
      (click)="$event.stopPropagation()"
    >
      <button
        type="button"
        class="idea-modal__close"
        (click)="closeExpandedIdea()"
        aria-label="Fechar detalhes"
      >
        ×
      </button>
      <p class="idea-modal__eyebrow">Projeto em destaque</p>
      <h3 class="idea-modal__title">{{ idea.title }}</h3>
      <div class="response-card__markdown idea-modal__content" [innerHTML]="idea.html"></div>
    </article>
  </div>
}
